<!-- Header Section -->
<div class="container-fluid header-container">
  <div class="container">
    <mat-toolbar class="toolbar">
      <mat-toolbar-row>
        <span class="animated fadeIn">{{ databaseTitle }}</span>
        <span class="spacer-toolbar"></span>
        <mat-icon [ngClass]="showMap ? 'active-btn' : 'inactive-btn'" aria-hidden="false" aria-label="map view"
          (click)="switchShowMap()">map
        </mat-icon>
        <mat-icon [ngClass]="showList ? 'active-btn' : 'inactive-btn'" aria-hidden="false" aria-label="list view"
          (click)="switchShowList()"> 
          view_list</mat-icon>
      </mat-toolbar-row>
    </mat-toolbar>
  </div>
</div>
<!-- -------------------- -->
<div class="container">
  <div class="row">
    <div class="col-12">
      <mat-accordion>
        <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
          <mat-expansion-panel-header>
            <mat-panel-title>
              Test
            </mat-panel-title>
          </mat-expansion-panel-header>
          <mat-list>

            <mat-list-item>
              Material Table
              <mat-slide-toggle [(ngModel)]="materialTable">
              </mat-slide-toggle>
            </mat-list-item>
            <mat-list-item>
              <mat-form-field>
                <input matInput placeholder="Number of observations" [(ngModel)]="numberOfObservationForTesting">
              </mat-form-field>
            </mat-list-item>

            <mat-list-item>
              <button mat-raised-button color="primary" (click)="generateObservationForTesting()">
                Generate {{numberOfObservationForTesting}} for testing</button>
            </mat-list-item>

            <mat-list-item>
              <button mat-raised-button color="accent" (click)="removeGeneratedObservations()">
                Remove Generated Observations
              </button>
            </mat-list-item>

          </mat-list>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>
  <br />
  <div *ngIf="showMap" class="row map-box" [ngClass]="showList ? 'map-box-partial' : 'map-box-full'">
    <div class="col-12">
      <app-map-preview [markers]="markers">
      </app-map-preview>
    </div>
  </div>
  <br />
  <div *ngIf="showList" class="row">
    <!-- MATERIAL TABLE -->
    <div *ngIf="materialTable" class="col-12">
      <table mat-table [dataSource]="dataSource">
        ['Observation_id', 'location', 'species', 'date', 'observer'];

        <!-- Observation ID Column -->
        <ng-container matColumnDef="Observation_id">
          <th mat-header-cell *matHeaderCellDef (click)="sortByObservationId()">
            Observation ID
            <i *ngIf="sortingByObservationId && !sortAscending" class="material-icons">arrow_downward</i>
            <i *ngIf="sortingByObservationId && sortAscending" class="material-icons">arrow_upward</i>
          </th>
          <td mat-cell *matCellDef="let item"> {{item.observation_id}} </td>
        </ng-container>

        <!-- Location Column -->
        <ng-container matColumnDef="location">
          <th mat-header-cell *matHeaderCellDef (click)="sortByLocation()">
            Location
            <i *ngIf="sortingByLocation && !sortAscending" class="material-icons">arrow_downward</i>
            <i *ngIf="sortingByLocation && sortAscending" class="material-icons">arrow_upward</i>
          </th>
          <td mat-cell *matCellDef="let item"> {{item.lat}}, {{item.long}} </td>
        </ng-container>

        <!-- Species Column -->
        <ng-container matColumnDef="species">
          <th mat-header-cell *matHeaderCellDef (click)="sortBySpecies()">
            Species
            <i *ngIf="sortingBySpecies && !sortAscending" class="material-icons">arrow_downward</i>
            <i *ngIf="sortingBySpecies&& sortAscending" class="material-icons">arrow_upward</i>
          </th>
          <td mat-cell *matCellDef="let item"> {{item.species ? item.species.commonName : ''}} </td>
        </ng-container>

        <!-- Date Column -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef (click)="sortByDate()">
            Date
            <i *ngIf="sortingByDate && !sortAscending" class="material-icons">arrow_downward</i>
            <i *ngIf="sortingByDate && sortAscending" class="material-icons">arrow_upward</i>
          </th>
          <td mat-cell *matCellDef="let item"> {{item.date | momentPipe:'YYYY-MM-DD'}} </td>
        </ng-container>

        <!-- Observer Column -->
        <ng-container matColumnDef="observer">
          <th mat-header-cell *matHeaderCellDef (click)="sortBySurveyor()">
            Observer
            <i *ngIf="sortingBySurveyor && !sortAscending" class="material-icons">arrow_downward</i>
            <i *ngIf="sortingBySurveyor && sortAscending" class="material-icons">arrow_upward</i>
          </th>
          <td mat-cell *matCellDef="let item"> {{item.observerFirstName + " " + item.observerLastName}} </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> </th>
          <td mat-cell *matCellDef="let item">
            <i class="material-icons" [matMenuTriggerFor]="menu">more_vert</i>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="view(item)">
                View
                <i class="material-icons action-icon">
                  visibility
                </i>
              </button>
              <button *ngIf="isDataEditor" mat-menu-item (click)="edit(item)">
                Edit
                <i class="material-icons action-icon">
                  edit
                </i>
              </button>
            </mat-menu>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <mat-paginator [pageSizeOptions]="[10]" showFirstLastButtons></mat-paginator>
    </div>
    <!-- END OF MATERIAL TABLE -->
    <!-- BOOTSTRAP TABLE -->
    <div *ngIf="!materialTable" class="col-12">
      <!-- ----- -->
      <table class="table table-hover">
        <thead class="thead, table-header">
          <tr>
            <th scope="col" (click)="sortByObservationId()">
              Observation ID
              <i *ngIf="sortingByObservationId && !sortAscending" class="material-icons">arrow_downward</i>
              <i *ngIf="sortingByObservationId && sortAscending" class="material-icons">arrow_upward</i>
            </th>
            <th scope="col" (click)="sortByLocation()">
              Location
              <i *ngIf="sortingByLocation && !sortAscending" class="material-icons">arrow_downward</i>
              <i *ngIf="sortingByLocation && sortAscending" class="material-icons">arrow_upward</i>
            </th>
            <th scope="col" (click)="sortBySpecies()">
              Species
              <i *ngIf="sortingBySpecies && !sortAscending" class="material-icons">arrow_downward</i>
              <i *ngIf="sortingBySpecies&& sortAscending" class="material-icons">arrow_upward</i>
            </th>
            <th scope="col" (click)="sortByDate()">
              Date
              <i *ngIf="sortingByDate && !sortAscending" class="material-icons">arrow_downward</i>
              <i *ngIf="sortingByDate && sortAscending" class="material-icons">arrow_upward</i>
            </th>
            <th scope="col" (click)="sortBySurveyor()">
              Observer
              <i *ngIf="sortingBySurveyor && !sortAscending" class="material-icons">arrow_downward</i>
              <i *ngIf="sortingBySurveyor && sortAscending" class="material-icons">arrow_upward</i>
            </th>
            <th scope="col">

            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row" *ngFor="let item of observations">
            <td scope="row" (click)="view(item)">{{item.observation_id}}</td>
            <td scope="row" (click)="view(item)">{{item.lat}}, {{item.long}}</td>
            <td scope="row" (click)="view(item)">{{item.species ? item.species.commonName : ''}}</td>
            <td scope="row" (click)="view(item)">{{item.date | momentPipe:'YYYY-MM-DD'}}</td>
            <td scope="row" (click)="view(item)">{{item.observerFirstName + " " + item.observerLastName}}</td>
            <td>
              <i class="material-icons" [matMenuTriggerFor]="menu">more_vert</i>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="view(item)">
                  View
                  <i class="material-icons action-icon">
                    visibility
                  </i>
                </button>
                <button *ngIf="isDataEditor" mat-menu-item (click)="edit(item)">
                  Edit
                  <i class="material-icons action-icon">
                    edit
                  </i>
                </button>
              </mat-menu>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- END OF BOOTSTRAP TABLE -->
  </div>
</div>