# Schema Model for Treatment 
version: '1.0'
description: Schema model for various Treatment
externalTables:
  - name: observation
    description: Observation table described in observation.codes.schema.yaml
    schema: ObservationSchema
  - name: species
    description: Species table 
    schema: SpeciesSchema
  - name: species_agency_code
    description: Species agency code table
    schema: SpeciesAgencyCodeSchema
schemas:
  ## -- MechanicalTreatmentSchema
  MechanicalTreatmentSchema:
    name: mechanical_treatment
    description: 'An application of a mechanical or cultural control. Mechanical weed control employs various implements and techniques to physically disturb weeds or to interrupt their reproduction by depleting root reserves through repeated defoliation of the plant. Mechanical control includes the mowing, ploughing, chopping, and crushing of weeds.
    Cultural control includes selective grazing, irrigation and deliberate flooding, mulching, hand pulling, and burning. Strategies and timing should depend on the weed species and its location in the province.'
    baseSchema: RecordSchema
    meta:
      resource: true
      api: /treatment/mechanical
    # End-meta
    displayLayout:
      fields:
        - header:
            key: 'species'
            default: 'Species'
          key: species.commonName
        - header:
            key: 'latitude'
            default: 'Latitude'
          key: latitude
        - header:
            key: 'longitude'
            default: 'Longitude'
          key: longitude
        - header:
            key: 'date'
            default: 'Date'
          key: date
    layout:
      title: 
        key: '' 
        default: 'Mechanical Treatment'
      sections: 
        - title: 
            key: '' 
            default: 'Basic Elements'
          groups:
            - title: 
                key: '' 
                default: Location
              fields: 
                - latitude
                - longitude
              style: {}
            - title: 
                key: '' 
                default: Applicator Information
              fields:
                - applicatorFirstName
                - applicatorLastName
                - secondaryApplicatorFirstName
                - secondaryApplicatorLastName
                - providerContractor
              style: {}
            - title: 
                key: '' 
                default: Time and Reference
              fields: 
                - date
                - paperFileReference
              style: {}
            - title: 
                key: '' 
                default: Geometry
              fields:
                - horizontalDimension
                - verticalDimension
              style: {}
        # End-Section
        - title: 
            key: '' 
            default: 'Treatment Details'
          groups:
            - title: 
                key: '' 
                default: Species 
              fields: 
                - species
                - speciesAgency
                - observation
              style: {}
            - title: 
                key: '' 
                default: Method and techniques
              fields:
                - mechanicalMethod
                - mechanicalDisposalMethod
                - rootRemoval
              style: {}
            - title: 
                key: '' 
                default: Issues
              fields:
                - soilDisturbance
                - issue
              style: {}
            - title: 
                key: '' 
                default: Additional Information
              fields:
                - signageOnSiteIndicator
                - comment
              style: {}
      # End-Section
    # End Of Layouts
    # Computed fields
    computedFields:
      observationArea:
        header:
          key: observationArea
          default: Observed area
        computationRules:
          - name: Compute Area
            keys:
              - horizontalDimension
              - verticalDimension
            method: calculateArea
    # End - Computed fields
    columns: 
      # -- Data Columns
      id: 
        name: 'mechanical_treatment_id'
        comment: 'Auto generated primary key'
        definition: SERIAL PRIMARY KEY
      latitude:
        name: 'mechanical_treatment_location_latitude'
        comment: 'Latitude of treatment  location'
        definition: NUMERIC(8, 6) NOT NULL
        meta: {}
        layout:
          header: 
            key: 'latitude' 
            default: 'Latitude'
          description: ''
          classes:
            - none
      longitude:
        name: 'mechanical_treatment_location_longitude'
        comment: 'Longitude of treatment location'
        definition: NUMERIC(9, 6) NOT NULL
        meta: {}
        layout:
          header: 
            key: 'longitude' 
            default: 'Longitude'
          classes:
            - none
      horizontalDimension:
        name: 'mechanical_treatment_area_horizontal_dimension'
        comment: 'Width or horizontal dimension of the area of treatment'
        definition: NUMERIC(7, 2) NULL DEFAULT 0.0
        meta: {}
        layout:
          header: 
            key: 'width' 
            default: 'Width or Radius'
          classes:
            - none
      verticalDimension:
        name: 'mechanical_treatment_area_vertical_dimension'
        comment: 'Length or vertical dimension of the area of treatment'
        definition: NUMERIC(7, 2) NULL DEFAULT 0.0
        meta: {}
        layout:
          header: 
            key: 'length' 
            default: 'Length or vertical dimension'
          classes:
            - none
      applicatorFirstName: 
        name: 'applicator_first_name'
        comment: 'First name of the applicator'
        definition: VARCHAR(100) NULL
        meta: {}
        layout:
          header: 
            key: 'applicatorFirstName' 
            default: 'Applicator First Name'
          classes:
            - none
      applicatorLastName: 
        name: 'applicator_last_name'
        comment: 'Last name of the applicator'
        definition: VARCHAR(100) NULL
        meta: {}
        layout:
          header: 
            key: 'applicatorLastName' 
            default: 'Applicator Last Name'
          classes:
            - none
      secondaryApplicatorFirstName: 
        name: 'secondary_applicator_first_name'
        comment: 'First name of the secondary applicator'
        definition: VARCHAR(100) NULL
        meta: {}
        layout:
          header: 
            key: 'secondaryApplicatorFirstName' 
            default: 'Secondary Applicator First Name'
          classes:
            - none
      secondaryApplicatorLastName: 
        name: 'secondary_applicator_last_name'
        comment: 'Last name of the secondary applicator'
        definition: VARCHAR(100) NULL
        meta: {}
        layout:
          header: 
            key: 'secondaryApplicatorLastName' 
            default: 'Secondary Applicator Last Name'
          classes:
            - none
      date:
        name: mechanical_treatment_date
        comment: 'Date of the treatment'
        definition: DATE NOT NULL
        meta: {}
        layout:
          header: 
            key: 'date' 
            default: 'Date'
          classes:
            - none
      paperFileReference:
        name: mechanical_treatment_paper_file_ref
        comment: 'Paper file reference associated with treatment'
        definition: VARCHAR(100) NULL
        meta: {}
        layout:
          header: 
            key: 'paperFileReference' 
            default: 'Paper File Ref'
          classes:
            - none
      comment:
        name: mechanical_treatment_comment
        comment: 'Comment on treatment record'
        definition: VARCHAR(500) NULL
        meta: {}
        layout:
          header: 
            key: 'comment' 
            default: 'Comment'
          classes:
            - none
      # -- Indicators --
      signageOnSiteIndicator:
        name: signage_on_site_ind
        comment: 'Sign collected for on site indicator'
        definition: BOOLEAN NOT NULL DEFAULT FALSE
        meta: {}
        layout:
          header: 
            key: 'signageOnSiteIndicator' 
            default: 'Sign collected'
          classes:
            - none
      ## -- Relationship columns
      observation:
        name: 'observation_id'
        comment: 'Observation associated with treatment'
        definition: INT NOT NULL
        foreignTable: observation
        refColumn: observation_id
        deleteCascade: true
        meta: 
          filters:
            location:
              note: Fetch relationship data based on location
              keys:
                - key: latitude
                  refKey: lat
                - key: longitude
                  refKey: long
        layout:
          header: 
            key: 'observation' 
            default: 'Observation'
          classes:
            - none
      species:
        name: 'species_id'
        comment: 'Species associated with a treatment'
        definition: INT NULL
        foreignTable: species
        refColumn: species_id
        deleteCascade: true
        meta: {}
        layout:
          header: 
            key: 'species' 
            default: 'Species'
          classes:
            - none
      speciesAgency:
        name: 'species_agency_code_id'
        comment: Foreign key reference to Species Agency Code table 
        definition: INT NULL
        foreignTable: species_agency_code
        refColumn: species_agency_code_id
        deleteCascade: false
        meta: {}
        layout:
          header: 
            key: 'speciesAgency' 
            default:  'Species Agency'
          classes:
            - none
      mechanicalMethod:
        name: 'mechanical_method_code_id'
        comment: Foreign key reference to Mechanical Method Code table 
        definition: INT NULL
        foreignTable: mechanical_method_code
        refColumn: mechanical_method_code_id
        deleteCascade: false
        meta: {}
        layout:
          header: 
            key: 'mechanicalMethod' 
            default: 'Mechanical Method'
          classes:
            - none
      mechanicalDisposalMethod:
        name: 'mechanical_disposal_method_code_id'
        comment: Foreign key reference to Mechanical Disposal Method Code table 
        definition: INT NULL
        foreignTable: mechanical_disposal_method_code
        refColumn: mechanical_disposal_method_code_id
        deleteCascade: false
        meta: {}
        layout:
          header: 
            key: 'mechanicalDisposalMethod' 
            default: 'Mechanical Disposal Methods'
          classes:
            - none
      soilDisturbance:
        name: 'mechanical_soil_disturbance_code_id'
        comment: Foreign key reference to Mechanical Soil Disturbance code 
        definition: INT NULL
        foreignTable: mechanical_soil_disturbance_code
        refColumn: mechanical_soil_disturbance_code_id
        deleteCascade: false
        meta: {}
        layout:
          header: 
            key: 'soilDisturbance' 
            default: 'Mechanical Soil Disturbance'
          classes:
            - none
      rootRemoval:
        name: 'mechanical_root_removal_code_id'
        comment: Foreign key reference to Mechanical Root Removal Code table
        definition: INT NULL
        foreignTable: mechanical_root_removal_code
        refColumn: mechanical_root_removal_code_id
        deleteCascade: false
        meta: {}
        layout:
          header: 
            key: 'rootRemoval' 
            default: 'Root Removal'
          classes:
            - none
      issue:
        name: 'mechanical_treatment_issue_code_id'
        comment: Foreign key reference to Mechanical Treatment Issue Code table
        definition: INT NULL
        foreignTable: mechanical_treatment_issue_code
        refColumn: mechanical_treatment_issue_code_id
        deleteCascade: false
        meta: {}
        layout:
          header: 
            key: 'issue' 
            default: 'Issue'
          classes:
            - none
      providerContractor:
        name: 'treatment_provider_contractor_id'
        comment: Foreign key reference to Mechanical Treatment Provider Contractor table
        definition: INT NULL
        foreignTable: treatment_provider_contractor
        refColumn: treatment_provider_contractor_id
        deleteCascade: false
        meta: {}
        layout:
          header: 
            key: 'providerContractor' 
            default: 'Contractor'
          classes:
            - none

  ## --
  ## -- MechanicalMethodCodeSchema
  MechanicalMethodCodeSchema:
    name: mechanical_method_code
    description: 'Indicates the method of mechanical or cultural control. Examples: mulching, burning, mowing.
    IAPP methods: Controlled Burning, Cultivation or till, Dead-heading, Digging, Flaming / Tiger Torch burn, Hand pulling, Hot water / Steam, Mowing Mulching, Suction dredging, Sheet Mulching , Salt water / Vinegar, Targeted grazing, Tarping , Seeding, Planting'
    columns:
      id: 
        name: 'mechanical_method_code_id'
        comment: 'Auto generated primary key'
        definition: SERIAL PRIMARY KEY
      code: 
        name: 'mechanical_method_code'
        comment: String encoded enum values for Mechanical treatment methods.
        definition: VARCHAR(4) NOT NULL UNIQUE
  ## --
  ## -- MechanicalDisposalMethodCodeSchema
  MechanicalDisposalMethodCodeSchema:
    name: mechanical_disposal_method_code
    description: 'Mechanical treatment disposal methods code. Indicate disposal method of species treated in mechanical treatment'
    columns:
      id: 
        name: 'mechanical_disposal_method_code_id'
        comment: 'Auto generated primary key'
        definition: SERIAL PRIMARY KEY
      code: 
        name: 'mechanical_disposal_method_code'
        comment: String encoded enum values for Mechanical disposal methods.
        definition: VARCHAR(6) NOT NULL UNIQUE
  ## --
  ## -- MechanicalTreatmentDisturbanceCodeSchema
  MechanicalSoilDisturbanceCodeSchema:
    name: mechanical_soil_disturbance_code
    description: 'This table is collection of soil disturbance code for mechanical treatment'
    columns:
      id: 
        name: 'mechanical_soil_disturbance_code_id'
        comment: 'Auto generated primary key'
        definition: SERIAL PRIMARY KEY
      code: 
        name: 'mechanical_soil_disturbance_code'
        comment: String encoded enum values for Mechanical Soil disturbance codes.
        definition: VARCHAR(6) NOT NULL UNIQUE
  ## --
  ## -- MechanicalRootSystemCodeSchema
  MechanicalRootRemovalCodeSchema:
    name: mechanical_root_removal_code
    description: 'This table is collection of mechanical root removal code for mechanical treatment'
    columns:
      id: 
        name: 'mechanical_root_removal_code_id'
        comment: 'Auto generated primary key'
        definition: SERIAL PRIMARY KEY
      code: 
        name: 'mechanical_root_removal_code'
        comment: String encoded enum values for Mechanical root system codes.
        definition: VARCHAR(6) NOT NULL UNIQUE
  ## -- 
  ## -- MechanicalTreatmentIssueCodeSchema
  MechanicalTreatmentIssueCodeSchema:
    name: mechanical_treatment_issue_code
    description: 'This table is collection of code related to mechanical treatments'
    columns:
      id: 
        name: 'mechanical_treatment_issue_code_id'
        comment: 'Auto generated primary key'
        definition: SERIAL PRIMARY KEY
      code: 
        name: 'mechanical_treatment_issue_code'
        comment: String encoded enum values for issue code related to mechanical treatments.
        definition: VARCHAR(6) NOT NULL UNIQUE
  ## -- 
  ## -- TreatmentProviderSchema
  TreatmentProviderContractorSchema:
    name: treatment_provider_contractor
    description: 'Treatment providers are govt contractors, who executes/applies treatment. This table contains list of such contractor and their details.'
    columns:
      id: 
        name: treatment_provider_contractor_id
        comment: 'Auto generated primary key'
        definition: SERIAL PRIMARY KEY
      registrationNumber:
        name: registration_number
        comment: 'The registration number associated with contractor'
        definition: INT NOT NULL UNIQUE
      businessName:
        name: business_name
        comment: 'The name of the contactor organization'
        definition: VARCHAR(100) NOT NULL
      category:
        name: category
        comment: 'The category label mentioned for contractor'
        definition: VARCHAR(100) NOT NULL
      address:
        name: address
        comment: 'The address of the contractor'
        definition: VARCHAR(200) NOT NULL
      regions:
        name: region_operation
        comment: 'Comma separated values of region of operation. Example LOWER MAINLAND, OMINECA, PEACE'
        definition: VARCHAR(1000) NULL
        notes:
          - type: dev
            note: This is not a standard column type for database. Need some clarification
      licenceExpiryDate:
          name: license_expiry_date
          comment: 'Date of expiry of license of contractor'
          definition: DATE NOT NULL
      serviceProvideIndicator:
          name: service_provide_ind
          comment: 'Indicator to show, associated contractor is active or not'
          definition: BOOLEAN NOT NULL DEFAULT TRUE
  ## --

